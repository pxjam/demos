parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"QnKi":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=t||{addFunc:function(e){var t,i,n=this;if(e.parent&&e.parent.remove(e),void 0===n.children)n.children=[];else for(t=n.children.length,i=0;i<t;i+=1)if(n.children[i]===e)return!1;if(void 0===n.childrenToBeAdded)n.childrenToBeAdded=[];else for(t=n.childrenToBeAdded.length,i=0;i<t;i+=1)if(n.childrenToBeAdded[i]===e)return!1;return n.childrenToBeAdded.push(e),!0},removeFunc:function(e){void 0!==e.onRemove&&e.onRemove(),e.expired=!0},destroyFunc:function(){void 0!==this.onRemove&&this.onRemove(),this.expired=!0},updateMatricesFunc:function(e){var i=this,n=t.Maths,o=i.parent;n.mat4P3Scale(n.__mat4Identity,i.scale,i.matrices.localScale),n.eulerToMat4(i.rot,i.rotOrder,i.matrices.localRotation),n.mat4Set(i.matrices.localComposite,i.matrices.localScale),n.mat4Mul(i.matrices.localComposite,i.matrices.localRotation,i.matrices.localComposite),n.mat4P3Translate(i.matrices.localComposite,i.pos,i.matrices.localComposite),o&&!o.isScene?n.mat4Mul(i.matrices.localComposite,o.matrices.globalComposite,i.matrices.globalComposite):null!=e?n.mat4Mul(i.matrices.localComposite,o.viewMatrix,i.matrices.globalComposite):n.mat4Set(i.matrices.globalComposite,i.matrices.localComposite),n.p3Mat4Mul([0,0,0],i.matrices.globalComposite,i.gPos),n.p3Mat4Mul(i.scale,i.matrices.globalComposite,i.gScale)},recursivelyUpdateMatrices:function e(t){t.parent&&!t.parent.isScene&&e(t.parent),t.updateMatrices()},transformPoints:function(e,i){var n,o=t.Maths;for(n=0;n<e.shape.points.length;n+=1)i[n]=o.p3Mat4Mul(e.shape.points[n],e.matrices.globalComposite,i[n])},getTransformedPointsFunc:function(){var e=this,i=[];return e.shape&&e.shape.points&&e.shape.points.length&&(t.recursivelyUpdateMatrices(e),t.transformPoints(e,i)),i},getWorldPositionFunc:function(){return t.recursivelyUpdateMatrices(this),t.Maths.p3Mat4Mul([0,0,0],this.matrices.globalComposite)},renderFunc:function(){var e=this;if(e.updateMatrices(e,e.scene.viewMatrix),e.shape&&e.shape.points&&e.shape.points.length){if(e.scene.updateTransformedPointCache(e),e.transformedPointCache.length>0&&("both"!==e.renderStyle&&"lines"!==e.renderStyle||e.transformedPointCache.length>1&&void 0!==e.shape.lines&&"number"==typeof e.shape.lines.length&&e.shape.lines.length>0&&e.scene.drawLines(e),"both"!==e.renderStyle&&"points"!==e.renderStyle||e.scene.drawPoints(e),"both"!==e.renderStyle&&"lines"!==e.renderStyle&&"points"!==e.renderStyle))throw"Invalid renderStyle specified: "+e.renderStyle}else e.transformedPointCache.length=0;e.postRender&&e.postRender()}};t.Maths={pi:Math.PI,tau:2*Math.PI,deg:Math.PI/180,sin:Math.sin,cos:Math.cos,square:function(e){return e*e},pointInNBounds:function(e,t){var i;for(i=0;i<e.length;i+=1)if(e[i]<t[0][i]||e[i]>t[1][i])return!1;return!0},pointIn2dBounds:function(e,t){return!(e[0]<t[0][0]||e[0]>t[1][0]||e[1]<t[0][1]||e[1]>t[1][1])},pointIn3dBounds:function(e,t){return!(e[0]<t[0][0]||e[0]>t[1][0]||e[1]<t[0][1]||e[1]>t[1][1]||e[2]<t[0][2]||e[2]>t[1][2])},getSquareVecLength2D:function(e,i){return t.Maths.square(e)+t.Maths.square(i)},getVecLength2D:function(e,i){return Math.sqrt(t.Maths.getSquareVecLength2D(e,i))},getRelativeAngle3D:function(e){var i=Math.atan2(e[1],e[0]),n=t.Maths.getVecLength2D(e[0],e[1]);return[0,-Math.atan2(e[2],n),i]},p3Add:function(e,t,i){var n=i||[];return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3],n},p3Sub:function(e,t,i){var n=i||[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3],n},pointAt:function(e,i){var n=t.Maths,o=n.p3Sub(i,e.gPos);e.rotOrder!==[2,1,0]&&(e.rotOrder=[2,1,0]),e.rot=n.getRelativeAngle3D(o)},__mat4Identity:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],makeMat4:function(){return this.__mat4Identity.slice()},mat3ToMat4Translation:[[0,1,2],[4,5,6],[8,9,10]],rotOrders:{"0,1,2":[0,1,2,0],"0,2,1":[0,2,1,1],"1,0,2":[1,0,2,1],"1,2,0":[1,2,0,0],"2,0,1":[2,0,1,0],"2,1,0":[2,1,0,1]},eulerToMat4:function(e,t,i){var n,o,r,s,a,l,c,p,h,d,u,f,m,g=this,y=i||g.makeMat4(),v=g.mat3ToMat4Translation,w=e.toString(),x=t.toString(),S=g.rotOrders[x],b=S[0],M=S[1],C=S[2],T=S[3];return y.euler!==w&&y.rotOrder!==x&&(y.euler=w,y.order=x,"0,0,0"===w?(y[0]=1,y[1]=0,y[2]=0,y[4]=0,y[5]=1,y[6]=0,y[8]=0,y[9]=0,y[10]=1):(T?(n=e[b],o=e[M],r=e[C]):(n=-e[b],o=-e[M],r=-e[C]),s=g.cos(n),a=g.cos(o),l=g.cos(r),c=g.sin(n),p=g.sin(o),d=s*l,u=s*(h=g.sin(r)),f=c*l,m=c*h,y[v[b][b]]=a*l,y[v[M][b]]=p*f-u,y[v[C][b]]=p*d+m,y[v[b][M]]=a*h,y[v[M][M]]=p*m+d,y[v[C][M]]=p*u-f,y[v[b][C]]=-p,y[v[M][C]]=a*c,y[v[C][C]]=a*s)),y},mat4Set:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e.euler=t.euler,e.order=t.order,e},mat4Mul:function(e,t,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],c=e[6],p=e[7],h=e[8],d=e[9],u=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],w=t[0],x=t[1],S=t[2],b=t[3],M=t[4],C=t[5],T=t[6],P=t[7],A=t[8],k=t[9],F=t[10],R=t[11],D=t[12],L=t[13],B=t[14],W=t[15],O=i||[];return O[0]=w*n+x*a+S*h+b*m,O[1]=w*o+x*l+S*d+b*g,O[2]=w*r+x*c+S*u+b*y,O[3]=w*s+x*p+S*f+b*v,O[4]=M*n+C*a+T*h+P*m,O[5]=M*o+C*l+T*d+P*g,O[6]=M*r+C*c+T*u+P*y,O[7]=M*s+C*p+T*f+P*v,O[8]=A*n+k*a+F*h+R*m,O[9]=A*o+k*l+F*d+R*g,O[10]=A*r+k*c+F*u+R*y,O[11]=A*s+k*p+F*f+R*v,O[12]=D*n+L*a+B*h+W*m,O[13]=D*o+L*l+B*d+W*g,O[14]=D*r+L*c+B*u+W*y,O[15]=D*s+L*p+B*f+W*v,O},mat4P3Translate:function(e,t,i){var n=i||this.makeMat4(),o=e[3],r=e[7],s=e[11],a=t[0],l=t[1],c=t[2];return n[3]=o+a,n[7]=r+l,n[11]=s+c,n},mat4P3Scale:function(e,t,i){var n=i||this.makeMat4(),o=t[0],r=t[1],s=t[2],a=e[0],l=e[1],c=e[2],p=e[3],h=e[4],d=e[5],u=e[6],f=e[7],m=e[8],g=e[9],y=e[10],v=e[11];return n[0]=a*o,n[1]=l*o,n[2]=c*o,n[3]=p*o,n[4]=h*r,n[5]=d*r,n[6]=u*r,n[7]=f*r,n[8]=m*s,n[9]=g*s,n[10]=y*s,n[11]=v*s,n},p3Mat4Mul:function(e,t,i){var n=i||[],o=e[0],r=e[1],s=e[2],a=e[3]||!1;return n[0]=o*t[0]+r*t[1]+s*t[2]+t[3],n[1]=o*t[4]+r*t[5]+s*t[6]+t[7],n[2]=o*t[8]+r*t[9]+s*t[10]+t[11],n[3]=a,n},__matrix:!1,p3Rotate:function(e,i,n){var o=t.Maths;return o.__matrix||(o.__matrix=o.makeMat4()),o.eulerToMat4(i,n,o.__matrix),o.p3Mat4Mul(e,o.__matrix)},getP3Scaled:function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},getP2Offset:function(e,t){return[e[0]+t[0],e[1]+t[1]]},getP3String:function(e){return"x: "+e[0]+" y: "+e[1]+" z: "+e[2]},nGetBounds:function(e){if(e.length<1)return[[0,0,0],[0,0,0]];for(var t=[],i=[],n=e[0],o=0;o<n.length;o+=1)t[o]=n[o],i[o]=n[o];for(var r=1;r<e.length;r+=1)for(n=e[r],o=0;o<n.length;o+=1)n[o]<t[o]?t[o]=n[o]:n[o]>i[o]&&(i[o]=n[o]);return[t,i]},makeBBCubeFromTwoPoints:function(e,t){return[[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]]]}},t.Utils={subset:function(e,t){var i,n={},o=t.split(",");for(i=0;i<o.length;i+=1)n[o[i]]=e[o[i]];return n},initVal:function(){var e;if(arguments.length<1)throw"ur doin it wrong. initVal function requires > 1 arguments";for(e=0;e<arguments.length;e+=1)if(void 0!==arguments[e]&&null!==arguments[e])return arguments[e];return arguments[e]},get_type:function(e){return null===e?"[object Null]":Object.prototype.toString.call(e)},displayDebug:function(e){var i,n=t.Utils,o=[];for(i in n.get_type(e).match(/Number/i)?o.push(e+"<br>"):o.push(e.constructor.name+"<br>"),e)e.hasOwnProperty(i)&&o.push(i.toString()+": "+n.get_type(e[i])+" - "+e[i]+"<br>");n.display||(n.display=document.createElement("pre"),n.display.style.display="block",n.display.style.position="fixed",n.display.style.top="0",n.display.style.left="0",n.display.style.fontFamily="monospace",n.display.style.fontSize="10px",n.display.style.lineHeight="7px",n.display.style.whiteSpace="pre-wrap",n.display.style.color="hsl("+Math.round(360*Math.random())+",100%,50%)"),document.body.appendChild(n.display),n.display.innerHTML+=o.join("\n")},clearDebug:function(){var e=t.Utils;e.display&&(e.display.innerHTML="",e.display.parentNode===document.body&&document.body.removeChild(e.display))}},t.Scene=function(e){var i=this;if("Scene"!==i.type)throw"You must use the `new` keyword when invoking the Scene constructor.";return e=e||{},i.debugViewport=e.debugViewport||!1,i.mpos={x:0,y:0},i.pixelScale=e.pixelScale||1,i.globalCompositeOperation=e.globalCompositeOperation||"source-over",i.backgroundColor=e.backgroundColor||"transparent",i.strokeStyle=e.strokeStyle||"#fff",i.fillStyle=e.fillStyle||"#fff",i.lineWidth=e.lineWidth||void 0,i.fullScreen=!(void 0!==e.fullScreen&&!0!==e.fullScreen),i.forceRealPixels=!(void 0!==e.forceRealPixels&&!0!==e.forceRealPixels),i.oldAndroid=/android 2/i.test(navigator.userAgent),i.mobileSafari=/iphone|ipad|ipod/i.test(navigator.userAgent),i.isMobile=i.oldAndroid||i.mobileSafari||/android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent),i.isChrome=/Chrome/i.test(navigator.userAgent),i.newChromeMobile=i.isMobile&&i.isChrome&&parseInt(navigator.userAgent.match(/Chrome\/(\d*)/i)[1])>18,i.mobileFireFox=i.isMobile&&/firefox/i.test(navigator.userAgent),i.useOuterWidth=i.oldAndroid||i.mobileFireFox,i.canvasId=e.canvasId||"canvas",i.existingCanvas=void 0!==e.canvas,i.canvas=e.canvas||document.createElement("canvas"),i.canvas.style.backgroundColor=e.canvasStyleColor||"#000",i.canvas.id=i.canvasId,i.c=i.canvas.getContext("2d"),void 0===e.canvas&&document.body.appendChild(i.canvas),i.fullScreen?(i.canvas.style.display="block",i.canvas.style.position="fixed",i.canvas.style.top=0,i.canvas.style.left=0,void 0!==e.zIndex&&(i.canvas.style.zIndex=e.zIndex),void 0!==window.orientation&&0===window.outerWidth?i.checkWindow=function(){var e=i.forceRealPixels?window.devicePixelRatio:1,t=window.screen.width;0!==window.orientation&&(t=window.screen.height),i.w=Math.ceil(e*t/i.pixelScale),i.h=Math.ceil(window.innerHeight/i.pixelScale)}:i.useOuterWidth?i.checkWindow=function(){i.w=Math.ceil(window.outerWidth/i.pixelScale),i.h=Math.ceil(window.outerHeight/i.pixelScale)}:i.checkWindow=function(){i.w=Math.ceil(window.innerWidth/i.pixelScale),i.h=Math.ceil(window.innerHeight/i.pixelScale)}):(i.checkWindow=function(){i.w=Math.ceil(i.canvas.width/i.pixelScale),i.h=Math.ceil(i.canvas.height/i.pixelScale)},""==i.canvas.width&&(i.canvas.width=e.width||512),""==i.canvas.height&&(i.canvas.height=e.height||384)),1!==i.pixelScale&&(i.canvas.style.imageRendering="-moz-crisp-edges",i.canvas.style.imageRendering="-webkit-optimize-contrast",i.c.imageSmoothingEnabled=!1,i.c.mozImageSmoothingEnabled=!1,i.c.webkitImageSmoothingEnabled=!1),i.isMobile||i.existingCanvas||(i.canvas.style.position="fixed"),i.checkWindow(),i.resize(),i.camera=e.camera||new t.Camera({scene:i}),i.canvas.style.backgroundColor=i.canvasStyleColor,i.cursorPosition=void 0!==e.canvas?"absolute":"relative",i.mouseHandler=function(e){var t=0,n=0,o=0,r=0;if(e.target!==i.canvas&&e.target!==window||e.preventDefault(),!i.fullScreen){var s=i.canvas.getBoundingClientRect();t=s.left,n=s.top}e.touches&&e.touches.length?(o=e.touches[0].clientX,r=e.touches[0].clientY):(o=e.clientX,r=e.clientY),"absolute"===i.cursorPosition&&(o-=t,r-=n),i.mpos.x=Math.ceil(o/i.pixelScale-i.cx),i.mpos.y=Math.ceil(r/i.pixelScale-i.cy)},window.addEventListener("mousemove",i.mouseHandler,!1),window.addEventListener("touchstart",i.mouseHandler,!1),window.addEventListener("touchmove",i.mouseHandler,!1),i.children=[],i.renderInstructionList=[],i.add(i.camera),i.start(),i.globalize(),this},t.Scene.prototype={type:"Scene",isScene:!0,globalize:function(){window.pi=t.Maths.pi,window.tau=t.Maths.tau,window.deg=t.Maths.deg,window.sin=t.Maths.sin,window.cos=t.Maths.cos,window.square=t.Maths.square},resize:function(){var e=this;e.cx=Math.floor(e.w/2),e.cy=Math.floor(e.h/2),e.mpos.x=0,e.mpos.y=0,e.canvas.width=e.w,e.canvas.height=e.h,1!==e.pixelScale?(e.canvas.style.width=Math.ceil(e.w*e.pixelScale)+"px",e.canvas.style.height=Math.ceil(e.h*e.pixelScale)+"px"):(e.canvas.style.width=e.w+"px",e.canvas.style.height=e.h+"px"),e.lw=e.w,e.lh=e.h,e.isMobile&&e.handleViewportShenanigans()},handleViewportShenanigans:function(){var e,t=this,i=document.getElementById("vp");i||((i=document.createElement("meta")).setAttribute("name","viewport"),i.setAttribute("id","vp")),i&&i.parentNode===document.head&&document.head.removeChild(i),e=t.forceRealPixels?t.getViewportForceRealPixelsString():t.getCommonViewportWidth()+t.commonViewportProperties,i.setAttribute("content",e),document.head.appendChild(i)},getCommonViewportWidth:function(){var e="width=device-width";return this.mobileSafari&&(e="width="+this.w),e},commonViewportProperties:", initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",getViewportForceRealPixelsString:function(){var e,t,i=this,n="";return i.mobileFireFox?n="width="+i.w+", user-scalable=no, target-densityDpi=device-dpi":i.mobileSafari||i.newChromeMobile?(t=", initial-scale="+(e=1/(window.devicePixelRatio||1))+", minimum-scale="+e+", maximum-scale="+e+", user-scalable=no",n=i.getCommonViewportWidth()+t):n="width=device-width, target-densityDpi=device-dpi"+i.commonViewportProperties,n},updateRecursively:function e(t){t.isScene||t.update(),t.children&&t.children.forEach(e)},renderRecursively:function e(t){!t.isScene&&t.render&&t.render(),t.children&&t.children.forEach(e)},removeExpiredChildrenRecursively:function e(t){var i,n;if(t.children)for(i=t.children.length-1;i>=0;i-=1)e(n=t.children[i]),n.expired&&(t.children.splice(i,1),n.expired=!1,n.parent=!1,n.scene=!1)},addNewChildrenRecursively:function e(t){var i,n=!1;if(void 0!==t.children&&void 0!==t.children.length&&t.children.length>0)for(var o=0;o<t.children.length;o++)e(t.children[o]);if(n=!0===t.isScene?t:t.scene,void 0!==t.childrenToBeAdded&&void 0!==t.childrenToBeAdded.length&&t.childrenToBeAdded.length>0){for(var r=0;r<t.childrenToBeAdded.length;r++)(i=t.childrenToBeAdded[r]).expired?i.expired=!1:(t.children.push(i),i.parent=t,i.scene=n,void 0!==i.onAdd&&i.onAdd());delete t.childrenToBeAdded}},render:function(){var e,t,i,n=this;if(void 0!==n.renderInstructionList&&n.renderInstructionList.length>0)for(t=n.renderInstructionList.length,e=0;e<t;e+=1)(i=n.renderInstructionList[e]).method(n.c,i.args)},update:function(){var e=this,i=t.Utils;try{if(e.checkWindow(),e.w===e.lw&&e.h===e.lh||e.resize(),e.debugViewport){var n=i.subset(window,"innerHeight,innerWidth,outerWidth,outerHeight,devicePixelRatio");n.screenSizeWidth=window.screen.width,n.screenSizeHeight=window.screen.height,n.documentElementClientWidth=document.documentElement.clientWidth,n.documentElementClientHeight=document.documentElement.clientHeight,n.devicePixelRatio=window.devicePixelRatio||1,n.navigator=navigator.userAgent,i.clearDebug(),i.displayDebug(n)}e.renderInstructionList=[],e.addNewChildrenRecursively(e),e.updateRecursively(e),e.viewMatrix=e.inverseMatrix(e.camera),e.renderRecursively(e),e.removeExpiredChildrenRecursively(e),"transparent"===e.backgroundColor?e.c.clearRect(0,0,e.w,e.h):(e.c.fillStyle=e.backgroundColor,e.c.fillRect(0,0,e.w,e.h)),e.c.save(),e.c.globalCompositeOperation=e.globalCompositeOperation,e.c.translate(e.cx,e.cy),e.renderInstructionList.sort(e.sortRenderInstructionByZDepth),e.render(),e.c.restore()}catch(o){e.stop(),console.log(o,o.stack,e)}},start:function(){var e=this;!function t(){e.update(),e.timer=requestAnimationFrame(t)}()},stop:function(){cancelAnimationFrame(this.timer)},sortRenderInstructionByZDepth:function(e,t){return e.z-t.z},recurseForInheritedProperties:function e(t,i){return void 0!==t[i]?t[i]:t.parent?e(t.parent,i):void 0},drawLine:function(e,t){e.beginPath(),e.moveTo(t.a.x,t.a.y),e.lineTo(t.b.x,t.b.y),e.strokeStyle!==t.color&&(e.strokeStyle=t.color),e.lineWidth!==t.lineWidth&&(e.lineWidth=t.lineWidth),"round"!==e.lineCap&&(e.lineCap="round"),e.stroke()},drawCircle:function(e,t){var i=t.pos.scale*t.pointScale;i>=0&&(e.moveTo(t.pos.x,t.pos.y),e.beginPath(),e.arc(t.pos.x,t.pos.y,i,0,tau,!1),"fill"===t.pointStyle?(e.fillStyle!==t.color&&(e.fillStyle=t.color),e.fill()):"stroke"===t.pointStyle&&(e.strokeStyle!==t.color&&(e.strokeStyle=t.color),e.lineWidth!==t.lineWidth&&(e.lineWidth=t.lineWidth),"round"!==e.lineCap&&(e.lineCap="round"),e.stroke()))},inverseMatrix:function(e){var i=t.Maths,n=i.makeMat4();do{var o=i.makeMat4();i.eulerToMat4(e.rot.map(function(e){return-e}),e.rotOrder.slice().reverse(),o),i.mat4P3Translate(n,[-e.pos[0],-e.pos[1],-e.pos[2]],n),i.mat4Mul(n,o,n),i.mat4P3Scale(n,e.scale.map(function(e){return-e})),e=e.parent}while(e&&!e.isScene);return n},updateTransformedPointCache:function(e){var i,n=t.Maths;e.transformedPointCache.length!==e.shape.points.length&&(e.transformedPointCache.length=0,e.lastGlobalCompositeMatrixString=!1),i=e.matrices.globalComposite.toString(),e.lastGlobalCompositeMatrixString&&e.lastGlobalCompositeMatrixString===i||(t.transformPoints(e,e.transformedPointCache),e.boundingBox=n.nGetBounds(e.transformedPointCache),e.lastGlobalCompositeMatrixString=i)},lineRenderLoop:function(e){var i,n,o,r=this,s=t.Maths;for(i=0;i<e.shape.lines.length;i+=1)if(n=e.transformedPointCache[e.shape.lines[i][0]],o=e.transformedPointCache[e.shape.lines[i][1]],n[2]<r.camera.clipNear&&o[2]<r.camera.clipNear&&n[2]>r.camera.clipFar&&o[2]>r.camera.clipFar){var a=r.camera.project3Dto2D(n),l=r.camera.project3Dto2D(o),c=[[-r.cx,-r.cy],[r.cx,r.cy]],p=s.pointIn2dBounds([a.x,a.y],c),h=s.pointIn2dBounds([l.x,l.y],c);(p||h)&&r.renderInstructionList.push({method:r.drawLine,args:{a:a,b:l,color:e.shape.lines[i][2]||e.shape.color||e.color||r.strokeStyle,lineWidth:e.lineWidth||e.parent.lineWidth||r.lineWidth||1},z:Math.max(n[2],o[2])})}},drawLines:function(e){var i,n,o,r,s,a,l=this,c=t.Maths;if(e.renderAlways)l.lineRenderLoop(e);else if(o=e.boundingBox[0],(r=e.boundingBox[1])[2]>l.camera.clipFar&&o[2]<l.camera.clipNear&&r[2]>l.camera.clipFar&&r[2]<l.camera.clipNear){for(n=c.makeBBCubeFromTwoPoints(o,r),s=!0,i=0;i<n.length&&s;i+=1)(a=l.camera.project3Dto2D(n[i])).x<l.cx&&a.x>-l.cx&&a.y<l.cy&&a.y>-l.cy&&(s=!1);s||l.lineRenderLoop(e)}},drawPoints:function(e){var i,n,o,r,s,a,l=this,c=t.Maths;if(e.renderAlways)l.pointRenderLoop(e);else if(n=e.boundingBox[0],(o=e.boundingBox[1])[2]>l.camera.clipFar&&n[2]<l.camera.clipNear&&o[2]>l.camera.clipFar&&o[2]<l.camera.clipNear){for(r=c.makeBBCubeFromTwoPoints(n,o),s=!0,i=0;i<r.length&&s;i+=1)(a=l.camera.project3Dto2D(r[i])).x<l.cx&&a.x>-l.cx&&a.y<l.cy&&a.y>-l.cy&&(s=!1);s||l.pointRenderLoop(e)}},pointRenderLoop:function(e){var i,n,o,r,s,a=this,l=t.Maths;for(i=0;i<e.transformedPointCache.length;i+=1){if((n=e.transformedPointCache[i])[2]<a.camera.clipNear&&n[2]>a.camera.clipFar)o=a.camera.project3Dto2D(n),r=[[-a.cx,-a.cy],[a.cx,a.cy]],l.pointIn2dBounds([o.x,o.y],r)&&(s={pos:o,pointScale:e.pointScale,pointStyle:e.pointStyle},"fill"===e.pointStyle?s.color=o.color||e.shape.color||e.color||a.fillStyle:"stroke"===e.pointStyle&&(s.color=o.color||e.shape.color||e.color||a.strokeStyle,s.lineWidth=e.lineWidth||e.scene.lineWidth||1),a.renderInstructionList.push({method:a.drawCircle,args:s,z:n[2]}))}},add:t.addFunc,remove:t.removeFunc},t.Camera=function(e){var i=this;if(e=e||{},"Camera"!==i.type)throw"You must use the `new` keyword when invoking the Camera constructor.";if(!e.scene)throw"You must provide a `scene` property when invoking the Camera constructor.";t.blessWith3DBase(i,e),i.clipNear=e.clipNear||-.01,i.clipFar=e.clipFar||-9001,i.frustumMultiplier=e.frustumMultiplier||.75},t.Camera.prototype={type:"Camera",update:function(){var e=this;e.pos[2]=Math.max(e.scene.w,e.scene.h)*e.frustumMultiplier},project3Dto2D:function(e){var t=this,i=Math.max(t.scene.w,t.scene.h),n=1/-e[2];return{x:e[0]*i*t.frustumMultiplier*n,y:e[1]*i*t.frustumMultiplier*n,scale:i*t.frustumMultiplier*n,color:e[3]||!1}}},t.Geom={cube:{points:[[10,10,10],[10,10,-10],[10,-10,10],[10,-10,-10],[-10,10,10],[-10,10,-10],[-10,-10,10],[-10,-10,-10]],lines:[[0,1],[2,3],[4,5],[6,7],[3,1],[2,0],[7,5],[6,4],[5,1],[7,3],[4,0],[6,2]]},axies:{points:[[4,0,0,"#f00"],[32,0,0,"#f00"],[22,6,-6,"#f00"],[22,-6,6,"#f00"],[0,4,0,"#0f0"],[0,32,0,"#0f0"],[6,22,-6,"#0f0"],[-6,22,6,"#0f0"],[0,0,4,"#00f"],[0,0,32,"#00f"],[-6,6,22,"#00f"],[6,-6,22,"#00f"]],lines:[[0,1,"#f00"],[1,2,"#f00"],[1,3,"#f00"],[4,5,"#0f0"],[5,6,"#0f0"],[5,7,"#0f0"],[8,9,"#00f"],[9,10,"#00f"],[9,11,"#00f"]]}},t.blessWith3DBase=function(e,i){var n=t.Maths;e.pos=i.pos||[0,0,0],e.rot=i.rot||[0,0,0],e.rotOrder=i.rotOrder||e.rotOrder||[0,1,2],e.scale=i.scale||e.scale||[1,1,1],e.gPos=e.pos.slice(),e.gScale=e.scale.slice(),e.matrices={localScale:n.makeMat4(),localRotation:n.makeMat4(),localComposite:n.makeMat4(),globalComposite:n.makeMat4()},e.lastGlobalCompositeMatrixString=!1,e.transformedPointCache=[],e.boundingBox=[[0,0,0],[0,0,0]],e.shape=i.shape||e.shape,e.color=i.color||e.color||void 0,e.renderAlways=i.renderAlways||e.renderAlways||!1,e.renderStyle=i.renderStyle||e.renderStyle||"lines",e.pointScale=i.pointScale||e.pointScale||2,e.pointStyle=i.pointStyle||e.pointStyle||"fill",e.lineWidth=i.lineWidth||void 0,e.scene=i.scene,e.expired=!1,e.add=t.addFunc,e.remove=t.removeFunc,e.destroy=t.destroyFunc,e.render=t.renderFunc,e.getTransformedPoints=t.getTransformedPointsFunc,e.getWorldPosition=t.getWorldPositionFunc,e.updateMatrices=t.updateMatricesFunc},t.Ob3D=function(e){if("Ob3D"!==this.type)throw"You must use the `new` keyword when invoking the Ob3D constructor.";return e=e||{},t.blessWith3DBase(this,e),this},t.Ob3D.prototype={type:"Ob3D",shape:t.Geom.cube,update:function(){}},t.Geom.font={"!":{points:[[1,0],[1,2],[1,3],[1,4]],lines:[[0,1],[2,3]]},'"':{points:[[1,1],[1,0],[0,0],[0,1]],lines:[[0,1],[2,3]]},"#":{points:[[2,4],[1,4],[0,3],[0,1],[1,0],[2,0],[2,1],[2,3]],lines:[[0,5],[1,4],[2,7],[3,6]]},$:{points:[[1,0],[1,4],[0,3],[0,1],[2,1],[2,3]],lines:[[0,1],[0,3],[0,4],[1,2],[1,5],[3,5]]},"%":{points:[[0,4],[2,0],[1,4],[2,3],[1,3],[0,1],[1,0],[1,1]],lines:[[0,1],[2,3],[2,4],[3,4],[5,7],[5,6],[6,7]]},"&":{points:[[2,4],[2,1],[0,1],[1,0],[1,2],[2,3],[0,3],[1,4]],lines:[[0,2],[1,3],[2,3],[4,6],[5,7],[6,7]]},"'":{points:[[1,1],[1,0]],lines:[[0,1]]},"(":{points:[[2,0],[2,4],[1,3],[1,1]],lines:[[0,3],[1,2],[2,3]]},")":{points:[[1,1],[1,3],[0,4],[0,0]],lines:[[0,1],[0,3],[1,2]]},"*":{points:[[1,3],[1,1],[0,2],[2,2],[0,3],[2,3],[0,1],[2,1]],lines:[[0,1],[2,3],[4,7],[5,6]]},"+":{points:[[2,2],[0,2],[1,1],[1,3]],lines:[[0,1],[2,3]]},",":{points:[[0,4],[1,3]],lines:[[0,1]]},"-":{points:[[2,2],[0,2]],lines:[[0,1]]},".":{points:[[1,4],[1,3],[0,4]],lines:[[0,2],[0,1],[1,2]]},"/":{points:[[2,1],[0,3]],lines:[[0,1]]},0:{points:[[2,3],[2,1],[0,1],[0,3],[1,4],[1,0]],lines:[[0,4],[0,1],[1,3],[1,5],[2,3],[2,5],[3,4]]},1:{points:[[0,1],[0,4],[2,4],[1,0],[1,4]],lines:[[0,3],[1,2],[3,4]]},2:{points:[[0,4],[2,1],[1,0],[2,4],[0,1]],lines:[[0,3],[0,1],[1,2],[2,4]]},3:{points:[[1,4],[1,0],[0,1],[0,3],[1,2],[2,1],[2,3]],lines:[[0,3],[0,6],[1,2],[1,5],[4,5],[4,6]]},4:{points:[[0,0],[2,0],[2,4],[0,2],[2,2]],lines:[[0,3],[1,2],[3,4]]},5:{points:[[2,3],[1,2],[0,2],[0,4],[2,0],[1,4],[0,0]],lines:[[0,5],[0,1],[1,2],[2,6],[3,5],[4,6]]},6:{points:[[1,0],[0,1],[2,3],[1,4],[0,3],[1,2]],lines:[[0,1],[1,4],[2,5],[2,3],[3,4],[4,5]]},7:{points:[[1,4],[2,0],[0,0]],lines:[[0,1],[1,2]]},8:{points:[[1,2],[1,4],[1,0],[0,1],[0,3],[2,1],[2,3]],lines:[[0,6],[0,5],[0,3],[0,4],[1,4],[1,6],[2,3],[2,5]]},9:{points:[[1,2],[2,1],[1,0],[0,1],[2,3],[1,4]],lines:[[0,1],[0,3],[1,2],[1,4],[2,3],[4,5]]},":":{points:[[1,0],[1,1],[1,4],[1,3]],lines:[[0,1],[2,3]]},";":{points:[[1,3],[0,4],[1,1],[1,0]],lines:[[0,1],[2,3]]},"<":{points:[[2,0],[2,4],[0,2]],lines:[[0,2],[1,2]]},"=":{points:[[2,1],[0,1],[2,3],[0,3]],lines:[[0,1],[2,3]]},">":{points:[[2,2],[0,0],[0,4]],lines:[[0,1],[0,2]]},"?":{points:[[1,2],[2,1],[0,1],[1,0],[1,4],[1,3]],lines:[[0,1],[1,3],[2,3],[4,5]]},"@":{points:[[2,1],[0,1],[1,0],[0,3],[1,4],[1,2],[1,3],[2,2],[2,3]],lines:[[0,2],[1,2],[1,3],[3,4],[4,8],[5,7],[5,6],[6,7],[7,8]]},A:{points:[[2,4],[1,0],[0,2],[0,4],[2,2]],lines:[[0,4],[1,2],[1,4],[2,4],[2,3]]},B:{points:[[2,3],[2,1],[1,2],[0,4],[0,0],[1,0],[1,4]],lines:[[0,2],[0,6],[1,2],[1,5],[3,4],[3,6],[4,5]]},C:{points:[[2,3],[2,1],[0,1],[0,3],[1,4],[1,0]],lines:[[0,4],[1,5],[2,3],[2,5],[3,4]]},D:{points:[[1,4],[1,0],[0,4],[0,0],[2,1],[2,3]],lines:[[0,2],[0,5],[1,3],[1,4],[2,3],[4,5]]},E:{points:[[2,4],[2,0],[2,2],[0,4],[0,0],[0,2]],lines:[[0,3],[1,4],[2,5],[3,4]]},F:{points:[[0,0],[0,4],[2,2],[2,0],[0,2]],lines:[[0,3],[0,1],[2,4]]},G:{points:[[1,2],[2,2],[2,1],[2,3],[1,0],[1,4],[0,3],[0,1]],lines:[[0,1],[1,3],[2,4],[3,5],[4,7],[5,6],[6,7]]},H:{points:[[2,4],[2,0],[0,4],[0,0],[0,2],[2,2]],lines:[[0,1],[2,3],[4,5]]},I:{points:[[0,4],[2,4],[0,0],[2,0],[1,0],[1,4]],lines:[[0,1],[2,3],[4,5]]},J:{points:[[2,0],[2,3],[1,4],[0,3]],lines:[[0,1],[1,2],[2,3]]},K:{points:[[0,0],[0,4],[2,0],[2,4],[0,2]],lines:[[0,1],[2,4],[3,4]]},L:{points:[[0,0],[2,4],[0,4]],lines:[[0,2],[1,2]]},M:{points:[[2,4],[0,4],[1,2],[0,0],[2,0]],lines:[[0,4],[1,3],[2,3],[2,4]]},N:{points:[[2,0],[2,4],[0,0],[0,4]],lines:[[0,1],[1,2],[2,3]]},O:{points:[[1,0],[1,4],[0,3],[0,1],[2,1],[2,3]],lines:[[0,3],[0,4],[1,2],[1,5],[2,3],[4,5]]},P:{points:[[1,0],[0,0],[0,4],[1,2],[2,1],[0,2]],lines:[[0,1],[0,4],[1,2],[3,4],[3,5]]},Q:{points:[[2,4],[2,3],[2,1],[0,1],[0,3],[1,4],[1,0]],lines:[[0,5],[1,5],[1,2],[2,6],[3,4],[3,6],[4,5]]},R:{points:[[2,4],[2,1],[1,2],[0,4],[0,0],[1,0],[0,2]],lines:[[0,2],[1,2],[1,5],[2,6],[3,4],[4,5]]},S:{points:[[2,3],[2,1],[0,1],[0,3],[1,4],[1,0]],lines:[[0,2],[0,4],[1,5],[2,5],[3,4]]},T:{points:[[1,4],[2,0],[0,0],[1,0]],lines:[[0,3],[1,2]]},U:{points:[[2,3],[2,0],[0,0],[0,3],[1,4]],lines:[[0,4],[0,1],[2,3],[3,4]]},V:{points:[[1,4],[0,1],[0,0],[2,0],[2,1]],lines:[[0,1],[0,4],[1,2],[3,4]]},W:{points:[[0,4],[2,4],[1,2],[2,0],[0,0]],lines:[[0,2],[0,4],[1,2],[1,3]]},X:{points:[[2,0],[0,0],[2,4],[0,4]],lines:[[0,3],[1,2]]},Y:{points:[[1,4],[1,2],[0,0],[2,0]],lines:[[0,1],[1,2],[1,3]]},Z:{points:[[0,0],[2,4],[2,0],[0,4]],lines:[[0,2],[1,3],[2,3]]},"[":{points:[[1,0],[1,4],[2,4],[2,0]],lines:[[0,1],[0,3],[1,2]]},"\\":{points:[[2,3],[0,1]],lines:[[0,1]]},"]":{points:[[0,0],[0,4],[1,4],[1,0]],lines:[[0,3],[1,2],[2,3]]},"^":{points:[[0,1],[2,1],[1,0]],lines:[[0,2],[1,2]]},_:{points:[[0,4],[2,4]],lines:[[0,1]]},"`":{points:[[0,0],[1,1]],lines:[[0,1]]},a:{points:[[2,4],[2,3],[2,2],[0,2],[0,3],[1,4],[1,1]],lines:[[0,1],[1,2],[1,5],[2,6],[3,4],[3,6],[4,5]]},b:{points:[[1,4],[0,0],[0,4],[1,2],[2,3],[0,2]],lines:[[0,2],[0,4],[1,2],[3,4],[3,5]]},c:{points:[[1,1],[1,4],[0,3],[0,2],[2,2],[2,3]],lines:[[0,3],[0,4],[1,2],[1,5],[2,3]]},d:{points:[[0,3],[1,2],[2,4],[2,0],[1,4],[2,2]],lines:[[0,1],[0,4],[1,5],[2,4],[2,3]]},e:{points:[[2,3],[2,2],[0,2],[0,3],[1,4],[1,1]],lines:[[0,4],[1,2],[1,5],[2,3],[2,5],[3,4]]},f:{points:[[2,2],[1,1],[1,3],[0,4],[0,2],[0,3]],lines:[[0,1],[1,4],[2,5],[3,4]]},g:{points:[[0,5],[1,6],[2,5],[1,1],[1,4],[0,3],[0,2],[2,2],[2,3]],lines:[[0,1],[1,2],[2,7],[3,6],[3,7],[4,5],[4,8],[5,6]]},h:{points:[[2,4],[0,0],[0,4],[1,2],[2,3],[0,2]],lines:[[0,4],[1,2],[3,4],[3,5]]},i:{points:[[1,1],[1,0],[1,2],[2,4],[0,4],[1,4]],lines:[[0,1],[2,5],[3,4]]},j:{points:[[1,2],[1,6],[0,5],[2,5],[2,2]],lines:[[0,4],[1,3],[1,2],[3,4]]},k:{points:[[2,4],[0,4],[0,0],[2,3],[2,1],[1,2],[0,2]],lines:[[0,3],[1,2],[3,5],[4,5],[5,6]]},l:{points:[[0,2],[2,4],[0,0]],lines:[[0,1],[0,2]]},m:{points:[[0,4],[2,1],[1,1],[1,2],[2,4],[0,1],[0,2]],lines:[[0,5],[1,3],[1,4],[2,3],[2,6]]},n:{points:[[2,4],[0,4],[1,1],[2,2],[0,2],[0,1]],lines:[[0,3],[1,4],[2,3],[2,4],[4,5]]},o:{points:[[2,3],[2,2],[0,2],[0,3],[1,4],[1,1]],lines:[[0,4],[0,1],[1,5],[2,3],[2,5],[3,4]]},p:{points:[[2,3],[1,4],[0,6],[0,2],[1,2],[0,4]],lines:[[0,1],[0,4],[1,5],[2,3],[3,4]]},q:{points:[[1,2],[2,2],[2,6],[1,4],[0,3],[2,4]],lines:[[0,1],[0,4],[1,2],[3,4],[3,5]]},r:{points:[[0,4],[0,1],[1,1],[2,2],[0,2]],lines:[[0,1],[2,3],[2,4]]},s:{points:[[1,1],[1,4],[0,3],[0,2],[2,2],[2,3]],lines:[[0,3],[0,4],[1,2],[1,5],[3,5]]},t:{points:[[1,1],[0,2],[2,2],[1,4]],lines:[[0,3],[1,2]]},u:{points:[[1,4],[0,3],[0,1],[2,1],[2,3]],lines:[[0,1],[0,4],[1,2],[3,4]]},v:{points:[[2,1],[0,1],[1,4]],lines:[[0,2],[1,2]]},w:{points:[[2,1],[2,3],[0,1],[1,3],[0,4],[1,4]],lines:[[0,1],[1,5],[2,4],[3,4],[3,5]]},x:{points:[[2,1],[0,1],[1,2],[0,4],[2,4],[1,3]],lines:[[0,2],[1,2],[2,5],[3,5],[4,5]]},y:{points:[[2,1],[0,1],[1,2],[1,4]],lines:[[0,2],[1,2],[2,3]]},z:{points:[[0,4],[2,1],[2,4],[0,1]],lines:[[0,1],[0,2],[1,3]]},"{":{points:[[1,1],[1,3],[0,2],[2,0],[2,4],[1,4],[1,0]],lines:[[0,2],[0,6],[1,2],[1,5],[3,6],[4,5]]},"|":{points:[[1,0],[1,4]],lines:[[0,1]]},"}":{points:[[1,1],[1,3],[2,2],[1,0],[1,4],[0,4],[0,0]],lines:[[0,2],[0,3],[1,2],[1,4],[3,6],[4,5]]},"~":{points:[[1,1],[1,3],[2,2],[0,2]],lines:[[0,1],[0,3],[1,2]]}},t.VText=function(e){var i=this;if("VText"!==i.type)throw"You must use the `new` keyword when invoking the VText constructor.";e=e||{},t.blessWith3DBase(i,e),i.string=e.string||"NEED INPUT",i.textAlign=e.textAlign||"center",i.characterWidth=2,i.characterHeight=4,i.characterHeightOffset=2,i.letterSpacing=e.letterSpacing||1,i.lineHeight=e.lineHeight||6,i.fontSize=e.fontSize||32,i.shape={points:[],lines:[]},i.stringCached=!1,i.font=e.font||t.Geom.font,i.cacheTextGeom()},t.VText.prototype={type:"VText",getStateString:function(){var e=this;return(e.string+e.textAlign+e.characterWidth+e.letterSpacing+e.lineHeight+e.fontSize).toString()},cacheTextGeom:function(){var e=this;e.lastGlobalCompositeMatrixString=!1,e.shape.points.length=0,e.shape.lines.length=0;var t=0,i={left:{charOffset:function(){return 0},spacingOffset:0},right:{charOffset:function(e){return-e},spacingOffset:e.letterSpacing},center:{charOffset:function(e){return-e/2},spacingOffset:e.letterSpacing/2}};if(!i.hasOwnProperty(e.textAlign))throw'You passed an unsupported textAlign type named "'+e.textAlign+'"';for(var n=i[e.textAlign].spacingOffset,o=e.string.split("\n"),r=0;r<o.length;r+=1){for(var s=o[r],a=s.length,l=i[e.textAlign].charOffset(a),c=0;c<a;c+=1){var p=s[c];if(" "===p);else if("\t"===p)l+=1;else{if(!e.font.hasOwnProperty(p))throw'This font does not contain the character "'+ch+'"';for(var h=e.font[p],d=0;d<h.points.length;d+=1)e.shape.points.push([(h.points[d][0]+(e.characterWidth+e.letterSpacing)*l+n)*e.fontSize/e.characterHeight,(h.points[d][1]+e.lineHeight*r-e.characterHeightOffset)*e.fontSize/e.characterHeight,h.points[d][2]||0]);for(var u=0;u<h.lines.length;u+=1){var f=h.lines[u];e.shape.lines.push([f[0]+t,f[1]+t])}t=e.shape.points.length}l+=1}l=0}e.stringCached=e.getStateString()},update:function(e){var t=this;t.getStateString()!==t.stringCached&&t.cacheTextGeom(),t.shape.color=t.color},destroy:t.destroyFunc},t.Layout=t.Layout||{},t.Layout.ResponsivePoint=function(e){var t=this,i="ResponsivePoint";if(t.type!==i)throw i+" must be invoked using the `new` keyword.";if(void 0!==(e=e||{}).offset&&"number"!=typeof e.offset.length)throw i+" constructor MUST be provided an `offset` array argument";if(void 0===e.scene||void 0===e.scene.type||"Scene"!==e.scene.type)throw i+" constructor MUST be provided a `Scene` object argument";return t.offset=e.offset,t.scene=e.scene,t.scene.add(t),t.update(),t},t.Layout.ResponsivePoint.prototype=[],t.Layout.ResponsivePoint.prototype.type="ResponsivePoint",t.Layout.ResponsivePoint.prototype.update=function(){this.offset[0]<0?this[0]=this.scene.cx+this.offset[0]:this.offset[0]>0?this[0]=this.offset[0]-this.scene.cx:this[0]=0,this.offset[1]<0?this[1]=this.scene.cy+this.offset[1]:this.offset[1]>0?this[1]=this.offset[1]-this.scene.cy:this[1]=0,this[2]=this.offset[2],void 0!==this.offset[3]?(this[3]=this.offset[3],this.length=4):this.length=3},t.Scene.prototype.drawSprite=function(e,t){e.save(),e.translate(t.point2D.x,t.point2D.y),t.depthScale?e.scale(t.spriteScale*t.point2D.scale,t.spriteScale*t.point2D.scale):e.scale(t.spriteScale,t.spriteScale),e.rotate(t.spriteRot),t.numFrames>1?(t.frameState+=.3,t.frameState>=t.numFrames&&(t.frameState=0),e.drawImage(t.image,t.width*Math.floor(t.frameState),0,t.width,t.height,t.offset.x,t.offset.y,t.width,t.height)):e.drawImage(t.image,t.offset.x,t.offset.y),e.restore()},t.Scene.prototype.renderSprite=function(e){var t=this;if(e.updateMatrices(),e.loaded){var i=e.gPos;i[2]<t.camera.clipNear&&i[2]>t.camera.clipFar&&(e.point2D=t.camera.project3Dto2D(i),e.point2D.x+e.offset.x*e.point2D.scale<t.cx&&e.point2D.x-e.offset.x*e.point2D.scale>-t.cx&&e.point2D.y+e.offset.y*e.point2D.scale<t.cy&&e.point2D.y-e.offset.y*e.point2D.scale>-t.cy&&t.renderInstructionList.push({method:t.drawSprite,args:e,z:i[2]}))}},t.renderSpriteFunc=function(){this.scene.renderSprite(this)},t.blessWithSpriteBase=function(e,i){if(!i.path)throw"You MUST provide an image `path` value on sprite type objects!";return t.blessWith3DBase(e,i),e.spriteRot=i.spriteRot||0,e.spriteScale=i.spriteScale||1,e.depthScale=i.depthScale||!1,e.numFrames=i.numFrames||1,e.frameState=e.numFrames,e.width=0,e.height=0,e.loaded=!1,e.image=new Image,e.image.onload=function(){e.width=e.image.width/e.numFrames,e.height=e.image.height,e.offset={x:-Math.round(e.width/2),y:-Math.round(e.height/2)},e.boundingBox=[[e.offset.x,e.offset.y,-32],[-e.offset.x,-e.offset.y,32]],e.loaded=!0},e.render=t.renderSpriteFunc,e.image.src=i.path,e},t.Sprite3D=function(e){var i=this;if("Sprite3D"!==i.type)throw"You must use the `new` keyword when invoking the Sprite3D constructor.";return t.blessWithSpriteBase(i,e),i},t.Sprite3D.prototype={type:"Sprite3D",update:function(){},destroy:t.destroyFunc},t.Utils=t.Utils||{},t.Utils.Color={detectCSSColorType:function(e){return e.indexOf("#")>-1?"hex":e.toLowerCase().indexOf("rgb")>-1?"rgb":e.toLowerCase().indexOf("hsl")>-1?"hsl":e.toLowerCase().indexOf("hsv")>-1&&"hsv"},hexToDec:function(e){return parseInt(e,16)},convertHexToRGBArray:function(e){var i,n,o,r=e.split(""),s=t.Utils.Color.hexToDec;return r.length<7?(i=s(""+r[1]+r[1]),n=s(""+r[2]+r[2]),o=s(""+r[3]+r[3])):(i=s(""+r[1]+r[2]),n=s(""+r[3]+r[4]),o=s(""+r[5]+r[6])),[i,n,o]},parenColorToArray:function(e){return e.replace(/rgb|hsl|hsv|a|\(|\)|;|%| /g,"").split(",").map(function(e,t){return t<3?parseInt(e):parseFloat(e)})},rgbArrayToHLSArray:function(e){var i=t.Utils.Color.rgbToHsl(e[0],e[1],e[2]);return i[0]*=360,i[1]*=100,i[2]*=100,e.length>3&&i.push(e[3]),i},hslArrayToRGBArray:function(e){var i=t.Utils.Color.hslToRgb(e[0]%360/360,e[1]/100,e[2]/100),n=Math.round;return i[0]=n(i[0]),i[1]=n(i[1]),i[2]=n(i[2]),e.length>3&&i.push(e[3]),i},colorStringToHSLAArray:function(e){var i,n=t.Utils.Color,o=n.detectCSSColorType(e),r=[];return"hex"===o?(i=n.convertHexToRGBArray(e),i=n.rgbArrayToHLSArray(i),r.push(i[0],i[1],i[2],1)):"rgb"===o?(i=n.parenColorToArray(e),i=n.rgbArrayToHLSArray(i),r.push(i[0],i[1],i[2],i[3]||1)):"hsl"===o&&(i=n.parenColorToArray(e),r.push(i[0],i[1],i[2],i[3]||1)),r},colorStringToHSLAString:function(e){var i=t.Utils.Color.colorStringToHSLAArray(e);return["hsla(",i[0]+",",i[1]+"%,",i[2]+"%,",i[3],");"].join("")},colorStringToRGBAArray:function(e){var i,n=t.Utils.Color,o=n.detectCSSColorType(e),r=[];return"hex"===o?(i=n.convertHexToRGBArray(e),r.push(i[0],i[1],i[2],1)):"hsl"===o?(i=n.parenColorToArray(e),i=n.hslArrayToRGBArray(i),r.push(i[0],i[1],i[2],i[3]||1)):"rgb"===o&&(i=n.parenColorToArray(e),r.push(i[0],i[1],i[2],i[3]||1)),r},colorStringToRGBAString:function(e){return["rgba(",t.Utils.Color.colorStringToRGBAArray(e).join(),");"].join("")},rgbToHsl:function(e,t,i){e/=255,t/=255,i/=255;var n,o,r=Math.max(e,t,i),s=Math.min(e,t,i),a=(r+s)/2;if(r==s)n=o=0;else{var l=r-s;switch(o=a>.5?l/(2-r-s):l/(r+s),r){case e:n=(t-i)/l+(t<i?6:0);break;case t:n=(i-e)/l+2;break;case i:n=(e-t)/l+4}n/=6}return[n,o,a]},hslToRgb:function(e,t,i){var n,o,r;if(0==t)n=o=r=i;else{function s(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}var a=i<.5?i*(1+t):i+t-i*t,l=2*i-a;n=s(l,a,e+1/3),o=s(l,a,e),r=s(l,a,e-1/3)}return[255*n,255*o,255*r]}},t.Fx=t.Fx||{},t.Fx.Tween=function(e){for(var t in this.o=e.object,this.properties=e.properties,this.onUpdate=e.onUpdate||void 0,this.callback=e.callback||void 0,this.method=e.method||this.transitionLinear,this.frames=1,this.frameState=0,this.frac=0,this.initialValues={},this.pos=[0,0,0],this.properties){if(this.properties.hasOwnProperty(t))void 0!==this.properties[t].length?this.initialValues[t]=this.o[t].slice(0):this.initialValues[t]=this.o[t]}return this.o.add(this),this},t.Fx.Tween.prototype={type:"Tween",transitionLinear:function(e){return e},update:function(){var e=this;for(var t in e.frac=e.method(e.frameState/e.frames),e.properties)if(e.properties.hasOwnProperty(t)){var i=e.properties[t],n=e.initialValues[t];if(void 0!==i.length)for(var o=0;o<i.length;o+=1)e.o[t][o]=n[o]+(i[o]-n[o])*e.frac;else e.o[t]=n+(i-n)*e.frac}void 0!==e.onUpdate&&e.onUpdate(e),e.frameState+=1,e.frameState>e.frames&&(void 0!==e.callback&&e.callback(e),e.o.remove(e))}},t.Fx=t.Fx||{},t.Fx.Explosion=function(e){var i=this;if("Explosion"!==i.type)throw"You must use the `new` keyword when invoking the Explosion constructor.";if(void 0===t.Utils||void 0===t.Utils.Color)throw"Please load the `NPos3d.Utils.Color` library prior to invoking the NPos3d.Fx.Explosion effects.";if(!(e=e||{}).object||!e.object.shape.lines||!e.object.transformedPointCache)throw"Fx.Explosion requires an Ob3D as the value for the `object` argument in the passed configuration object.";if(!e.scene||"Scene"!==e.scene.type)throw"Fx.Explosion requires a Scene as the value for the `scene` argument in the passed configuration object.";return i.o=e.object,e.scene.add(i),i},t.Fx.Explosion.prototype={type:"Explosion",update:function(){var e=this;e.lines=e.o.shape.lines,e.points=e.o.getTransformedPoints(),e.lines.forEach(function(i){var n=e.points[i[0]],o=e.points[i[1]],r=i[2]||e.o.shape.color||e.o.color||e.scene.strokeStyle;e.scene.add(new t.Fx.ExplosionLine({p1:n,p2:o,object:e.o,scene:e.scene,colorArray:t.Utils.Color.colorStringToRGBAArray(r)}))}),e.o.destroy(),e.destroy()},destroy:t.destroyFunc},t.Fx.ExplosionLine=function(e){var i=this,n="ExplosionLine";if(i.type!==n)throw"You must use the `new` keyword when invoking the "+n+" constructor.";return(e=e||{}).shape={},t.blessWith3DBase(i,e),i.o=e.object,i.scene=e.scene,i.pos=i.o.gPos.slice(0),i.p1=i.subVel(e.p1.slice(0),i.pos),i.p2=i.subVel(e.p2.slice(0),i.pos),i.midpoint=i.getMidpoint(),i.addVel(i.pos,i.midpoint),i.subVel(i.p1,i.midpoint),i.subVel(i.p2,i.midpoint),i.shape.points=[i.p1,i.p2],i.shape.lines=[[0,1]],i.colorArray=e.colorArray,i.vel=e.vel||[i.rint(2),i.rint(2),i.rint(2)],i.rotVel=e.rotVel||[i.rneg(2)*deg,i.rneg(2)*deg,i.rneg(2)*deg],i.lifespan=50+i.rint(100),i.life=i.lifespan,i.scene.add(i),i},t.Fx.ExplosionLine.prototype={type:"ExplosionLine",rneg:function(e){return(2*Math.random()-1)*e},rint:function(e){return Math.round((2*Math.random()-1)*e)},rpos:function(e){return Math.random()*e},rintpos:function(e){return Math.round(Math.random()*e)},getMidpoint:function(){var e=this,t=[e.p2[0]-e.p1[0],e.p2[1]-e.p1[1],e.p2[2]-e.p1[2]];return t[0]/=2,t[1]/=2,t[2]/=2,t[0]+=e.p1[0],t[1]+=e.p1[1],t[2]+=e.p1[2],t},addVel:function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e},subVel:function(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e},update:function(){var e=this,t=e.colorArray;e.addVel(e.pos,e.vel),e.addVel(e.rot,e.rotVel),e.color=["rgba(",t[0],",",t[1],",",t[2],",",t[3]*(e.life/e.lifespan),")"].join(""),e.life-=1,e.life<1&&e.destroy()}},t.Geom.Circle=function(e){var t=this;if("Circle"!==t.type)throw"You must use the `new` keyword when invoking the Circle constructor.";return e=e||{},t.color=e.color||void 0,t.segments=e.segments||12,t.offset=e.offset||0,t.points=[],t.lines=[],t.radius=e.radius||20,t.axies=e.axies||[0,1,2],t.formCircle(),t},t.Geom.Circle.prototype={type:"Circle",formCircle:function(){var e,i,n,o=this,r=t.Maths,s=r.tau/o.segments;for(o.points=[],o.lines=[],e=0;e<o.segments;e+=1)i=[],n=s*e+o.offset,i[o.axies[0]]=r.cos(n)*o.radius,i[o.axies[1]]=r.sin(n)*o.radius,i[o.axies[2]]=0,o.points.push(i),e>0&&e<=o.segments&&(o.lines.push([e-1,e]),e===o.segments-1&&o.lines.push([e,0]));return o}},t.Geom.Sphere=function(e){var t={};e=e||{},t.color=e.color||void 0,t.points=[],t.lines=[],t.order=e.order||"xzy";for(var i=e.radius||20,n=e.segments||12,o=tau/n,r=e.rings||8,s=pi/(r-1),a=0,l=0,c=0;c<r;c+=1){var p=Math.cos(s*c)*i;if(0===c||c===r-1){if("xyz"===t.order||"yxz"===t.order?t.points.push([0,0,p]):"xzy"===t.order||"yzx"===t.order?t.points.push([0,p,0]):"zxy"!==t.order&&"zyx"!==t.order||t.points.push([p,0,0]),a=t.points.length-1,c===r-1)for(l=0;l<n;l+=1)t.lines.push([a-l-1,a])}else{var h=Math.sin(s*c)*i;for(l=0;l<n;l+=1){var d=Math.sin(o*l)*h,u=Math.cos(o*l)*h;"xyz"===t.order?t.points.push([d,u,p]):"xzy"===t.order?t.points.push([d,p,u]):"zyx"===t.order?t.points.push([p,u,d]):"zxy"===t.order?t.points.push([p,d,u]):"yxz"===t.order?t.points.push([u,d,p]):"yzx"===t.order&&t.points.push([u,p,d]),(a=t.points.length-1)<n+1&&t.lines.push([0,a]),a>1&&l>0&&t.lines.push([a-1,a]),l===n-1&&t.lines.push([a-(n-1),a]),a>n&&t.lines.push([a-n,a])}}}return t},t.Geom.Lathe=function(t){var i=this;if("Lathe"!==i.type)throw"Lathe constructor requires the use of the `new` keyword.";if("object"!==e(t.shape)||"object"!==e(t.shape.points)||"number"!=typeof t.shape.points.length)throw"Lathe constructor requires the that the configuration object contains a `shape` property containing an object with a `points` array.";i.shape=t.shape,i.axis=0===t.axis?0:t.axis||1,i.segments=t.segments||12,i.frac=t.frac||tau,i.points=[],i.lines=[],i.generate()},t.Geom.Lathe.prototype={type:"Lathe",generate:function(){var e,i,n,o,r,s=this,a=t.Maths,l=s.frac/parseInt(s.segments),c=[0,0,0],p=a.makeMat4(),h=s.shape.points.length,d=s.shape.lines.length;for(s.points.length=0,s.lines.length=0,e=0;e<s.segments;e+=1){for(c[s.axis]=l*e,a.eulerToMat4(c,[0,1,2],p),i=0;i<h;i+=1)n=s.shape.points[i],s.points.push(a.p3Mat4Mul(n,p)),s.shape.lines.length>0&&(e>0&&s.lines.push([e*h+i,(e-1)*h+i]),e===s.segments-1&&s.lines.push([e*h+i,i]));for(o=0;o<d;o+=1)r=s.shape.lines[o],s.lines.push([e*h+r[0],e*h+r[1]])}}},t.Geom.Twist=function(t){var i=this;if("Twist"!==i.type)throw"Twist constructor requires the use of the `new` keyword.";if("object"!==e(t.shape)||"object"!==e(t.shape.points)||"number"!=typeof t.shape.points.length)throw"Twist constructor requires the that the configuration object contains a `shape` property containing an object with a `points` array.";i.shape=t.shape,0===t.axis?i.axis=0:i.axis=t.axis||1,i.points=[],i.factor=0===t.factor?0:t.factor||tau,i.offset=t.offset||0,i.generate()},t.Geom.Twist.prototype={type:"Twist",generate:function(){var e,i,n,o=this,r=t.Maths,s=r.nGetBounds(o.shape.points),a=s[1][o.axis]-s[0][o.axis],l=o.shape.points.length,c=[0,0,0],p=r.makeMat4();for(o.points.length=0,e=0;e<l;e+=1)n=((i=o.shape.points[e].slice())[o.axis]-s[0][o.axis])/a+o.offset,c[o.axis]=n*o.factor,r.eulerToMat4(c,[0,1,2],p),r.p3Mat4Mul(i,p,i),o.points.push(i);void 0!==o.shape.lines&&(o.lines=o.shape.lines.slice())}};var i=t;exports.default=i;
},{}]},{},["QnKi"], null)
//# sourceMappingURL=npos3d.1c557a4f.js.map